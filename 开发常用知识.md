# 开发常用知识

## JWT（Json Web Token）

### 构成

1. header

   > 做声明的工作。采用base64加密，可对称解密。
   >
   > ```json
   > {
   >   'typ': 'JWT',
   >   'alg': 'HS256'
   > }
   > ```

   - 声明类型，这里是jwt
   - 声明加密的算法，通常直接使用 HMAC SHA256

2. payload

   > 存储有效信息。采用base64加密。不建议添加敏感信息，因为该部分在客户端可解密。
   >
   > ```json
   > {
   >   "sub": "1234567890",
   >   "name": "John Doe",
   >   "admin": true
   > }
   > ```

   - **标准中注册的声明**：

     - **iss**: jwt签发者
     - **sub**: jwt所面向的用户
     - **aud**: 接收jwt的一方
     - **exp**: jwt的过期时间，这个过期时间必须要大于签发时间
     - **nbf**: 定义在什么时间之前，该jwt都是不可用的
     - **iat**: jwt的签发时间
     - **jti**: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。

   - **公共的声明**：

     ​	公共的声明可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息。

   - **私有的声明**：

     ​	私有声明是提供者和消费者所共同定义的声明。

3. signature

   > 签证信息。base64加密后的header和payload使用`.`连接组成的字符串，然后通过header中声明的加密方式进行加盐`secret`组合加密。

### 应用

![img](https://upload-images.jianshu.io/upload_images/1821058-2e28fe6c997a60c9.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

### 特点

1. 优点

   - 跨语言
   - 可携带信息
   - 空间占用小
   - 不需要保存

2. 缺点

   - 占带宽
   - 加密算法性能

   - **逻辑失效，但物理有效**

     > token 一旦派发出去，如果后端不增加其他逻辑的话，它在失效之前都是有效的。

     解决方案：

     1. 写入数据库或缓存
     2. 黑名单机制
     3. 用户专属密钥（修改密码操作可使用用户密码）
     4. 短有效期

   - **续签问题**

     > 短有效期如何避免用户经常登录。

     解决方案：

     1. 每次检查token发现快过期就重新派发
     2. 每次都返回新的token
     3. 有效期设置在半夜
     4. 双token机制，一个是正常短有效期，另一个是长有效期仅用于在第一个token快过期时更换一个新的token

## BCrypt加密工具

### 加密

- （明文+随机盐值）通过hash算法得到60位的密文
- 密文存储于数据库中

### 解密

- （明文+密文）通过hash算法得到60位的密文
- 按位和数据库中的密文(^)与操作
- 查看结果是否为0



